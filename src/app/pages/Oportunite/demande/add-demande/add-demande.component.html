
<!-- Tabs navs -->
<dx-popup
        [maxWidth]="940"
        [width]="500"
        [height]="'auto'"
        [showTitle]="true"
        title="Créer une opportunité"
        [dragEnabled]="false"
        [closeOnOutsideClick]="true"
        [(visible)]="showModal">

    <p>Voulez-vous créer une opportunité pour cette demande ?</p>
    <div class="row">
    <div class="col-lg-6 col-md-6 col-sm-8 col-xs-12">
    <button
            class="btn btn-secondary"
            (click)="onCancelClick()">Annuler</button> </div>
    <div class="col-lg-6 col-md-6 col-sm-8 col-xs-12 alignRight">
    <button
            class="btn btn-primary"
            (click)="onCreateOpportunityClick()">Créer Opportunité</button></div>
    </div>
</dx-popup>
<div>

    <div class="card-header text-center bg-secondary text-white" style="background-color: #40B3A2 !important;">
        <div class="d-flex justify-content-center align-items-center" style="width: 100%;">
            <div *ngIf="demandeForm !== undefined" class="d-flex align-items-center">
                <h5 class="mb-0">Demande N°:({{objectData?.id}})</h5>
                <div class="icon-container ml-3" style="cursor: pointer;" (click)="showPopupWF()" title="{{'show-event.Voir la liste des événements' | translate}}">
                    <i class="fas fa-project-diagram"></i>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Tabs content -->
<div class="tab-content" id="ex2-content">
    <!-- acctiver when verification is true-->
    <div
            class="tab-pane fade {{ pourvalidation ? 'show active' : '' }}"
            id="ex3-tabs-1"
            role="tabpanel"
            aria-labelledby="ex3-tab-1"
            *ngIf="pourvalidation"
    >
        <style>

            .custom-field {
                border: 1px solid #40B3A2;
                border-top: none;
                margin-top: 32px ;

                padding: 8px;
                border-radius: 8px !important;
            }

            .custom-field h1 {
                font-size: 15px;
                margin: -16px -8px 0;
                color: #40B3A2;

                font-weight: 500;
            }

            .custom-field h1 span {
                float: left;
            }

            .custom-field h1:before {
                border-top: 1px solid #40B3A2;
                content: ' ';
                float: left;
                margin: 8px 2px 0 2px;
                width: 20px;
                border-radius: 8px !important;
            }

            .custom-field h1:after {
                border-top: 1px solid #40B3A2;
                content: ' ';
                display: block;
                height: 24px;
                left: 2px;
                margin: 0 1px 0 0;
                overflow: hidden;
                position: relative;
                top: 8px;
                border-top-right-radius: 8px ;
            }
            .fieldContent{

                padding: 20px;
            }

        </style>

        <div class="custom-field">
            <h1>
                    <span>
                       Demande Information
                    </span>
            </h1>
            <div class="fieldContent">
        <form  [formGroup]="demandeF"  method="post" novalidate>
            <div class="form-group">
                <label>Titre</label>
                <input type="text" formControlName="nom"  class="form-control" required>
                <div *ngIf="demandeF.get('nom').invalid && (demandeF.get('nom').dirty || demandeF.get('nom').touched)" class="text-danger">
                    <div *ngIf="demandeF.get('nom').errors.required">
                        Le nom est requis.
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label>Client</label>
                <select #clientSelect class="form-select" >
                    <option *ngFor="let client of clients" [value]="client?.id">{{ client.nom }}</option>
                </select>
                <div *ngIf="demandeF.get('client').invalid && (demandeF.get('client').dirty || demandeF.get('client').touched)" class="text-danger">
                    <div *ngIf="demandeF.get('client').errors.required">
                        Le client est requis.
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Source de la demande</label>

                <select class="form-select" formControlName="source" id="sourceDemande">
                    <option value="email">Email</option>
                    <option value="telephone">Téléphone</option>
                    <option value="siteWeb">Site Web</option>

                </select>
                <div *ngIf="demandeF.get('source').invalid && (demandeF.get('source').dirty || demandeF.get('source').touched)" class="text-danger">
                    <div *ngIf="demandeF.get('source').errors.required">
                        La source est requise.
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="deadline" class="form-label">Date de deadline:</label>
                <input class="form-control" formControlName="deadline"  type="date">
                <div *ngIf="demandeF.get('deadline').invalid && (demandeF.get('deadline').dirty || demandeF.get('deadline').touched)" class="text-danger">
                    <div *ngIf="demandeF.get('deadline').errors.required">
                        La date de deadline est requise.
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label>Description:</label>
                <div class="textarea-container">
                <textarea class="form-control" formControlName="description"  rows="5" cols="30" required></textarea>
                <i class="fas fa-microphone" (click)="startListening()"></i>
                </div>
                <div *ngIf="demandeF.get('description').invalid && (demandeF.get('description').dirty || demandeF.get('description').touched)" class="text-danger">
                    <div *ngIf="demandeF.get('description').errors.required">
                        La description est requise.
                    </div>
                </div>
            </div>
            <div class="dx-field">
                <div class="dx-field-label">Select Categorie</div>
                <div class="dx-field-value">
                    <dx-drop-down-box
                            [(value)]="gridBoxValue"
                            [inputAttr]="{ 'aria-label': 'Owner' }"
                            valueExpr="ID"
                            displayExpr="nom"
                            placeholder="Select a value..."
                            [showClearButton]="true"
                            [dataSource]="cats"
                    >
                        <div *dxTemplate="let data of 'content'">
                            <dx-data-grid
                                    [dataSource]="cats"
                                    [columns]="['nom']"
                                    [selection]="{ mode: 'multiple' }"
                                    [hoverStateEnabled]="true"
                                    [paging]="{ enabled: true, pageSize: 10 }"
                                    [filterRow]="{ visible: true }"
                                    [scrolling]="{ mode: 'virtual' }"
                                    [height]="345"
                                    [(selectedRowKeys)]="gridBoxValue"
                            >
                            </dx-data-grid>
                        </div>
                    </dx-drop-down-box>
                </div>
            </div>


        </form>
</div>
            </div>
        <div class="custom-field">
            <h1>
                    <span>
                      Gestion des fichiers
                    </span>
            </h1>

            <app-attachement-grid-only [classid]="ClassId" [objectid]="ObjectId"></app-attachement-grid-only>
            </div>

    </div>
    <div
            class="tab-pane fade {{ pourvalidation2 ? 'show active' : '' }}"
            id="ex3-tabs-2"
            role="tabpanel"
            aria-labelledby="ex3-tab-2"
            *ngIf="pourvalidation2"
    >
        <form  [formGroup]="demandeF"  method="post" novalidate>
            <div class="form-group">
                <label>Titre:</label>
                <input type="text" formControlName="nom" class="form-control" required>
            </div>
            <div class="form-group">
                <label>Client</label>
                <select #clientSelect class="form-control"  >
                    <option *ngFor="let client of clients" [value]="client?.id">{{ client.nom }}</option>
                </select>
            </div>

<!--            <div class="form-group">-->
<!--                <label>Statut:</label>-->
<!--                <select class="form-control" formControlName="statut" >-->
<!--                    <option *ngFor="let status of statusList" [value]="status">{{ status }}</option>-->
<!--                </select>-->
<!--            </div>-->
            <div class="form-group">
                <label>Source de la demande</label>

                <select class="form-select" formControlName="source" id="sourceDemande">
                    <option value="email">Email</option>
                    <option value="telephone">Téléphone</option>
                    <option value="siteWeb">Site Web</option>

                </select>
                <div *ngIf="demandeF.get('source').invalid && (demandeF.get('source').dirty || demandeF.get('source').touched)" class="text-danger">
                    <div *ngIf="demandeF.get('source').errors.required">
                        La source est requise.
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="deadline" class="form-label">Date de deadline:</label>
                <input class="form-control" formControlName="deadline"  type="date">
            </div>
            <div class="form-group">
                <label>Description:</label>
                <textarea class="form-control" formControlName="description"  rows="5" cols="30" required></textarea>
            </div>
            <div class="custom-field">
                <h1>
                    <span>
                      Gestion des fichiers
                    </span>
                </h1>

                <app-attachement-grid-only [classid]="ClassId" [objectid]="ObjectId"></app-attachement-grid-only>
            </div>


        </form>

    </div>
    <div
            class="tab-pane fade {{ elsedesision ? 'show active' : '' }}"
            id="ex3-tabs-3"
            role="tabpanel"
            aria-labelledby="ex3-tab-3"
            *ngIf="elsedesision"
    >

        <form  [formGroup]="demandeF" id="basic-form" method="post" novalidate>
            <div class="form-group">
                <label>Titre :</label>
                <input type="text" formControlName="nom" id="nom" class="form-control" required>
            </div>
            <div class="form-group">
                <label>Client</label>
                <select #clientSelect class="form-control" id="client" >
                    <option *ngFor="let client of clients" [value]="client?.id">{{ client.nom }}</option>
                </select>
            </div>


<!--            <div class="form-group">-->
<!--                <label>Statut:</label>-->
<!--                <select class="form-control" formControlName="statut" id="statut">-->
<!--                    <option *ngFor="let status of statusList" [value]="status">{{ status }}</option>-->
<!--                </select>-->
<!--            </div>-->
            <div class="form-group">
                <label>Source de la demande</label>

                <select class="form-select" formControlName="source" id="sourceDemande">
                    <option value="email">Email</option>
                    <option value="telephone">Téléphone</option>
                    <option value="siteWeb">Site Web</option>

                </select>
                <div *ngIf="demandeF.get('source').invalid && (demandeF.get('source').dirty || demandeF.get('source').touched)" class="text-danger">
                    <div *ngIf="demandeF.get('source').errors.required">
                        La source est requise.
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="deadline" class="form-label">Date de deadline:</label>
                <input class="form-control" formControlName="deadline"   id="deadline" type="date">
            </div>
            <div class="form-group">
                <label>Description:</label>
                <textarea class="form-control" formControlName="description"  rows="5" cols="30" required></textarea>
            </div>
            <div class="custom-field">
                <h1>
                    <span>
                      Gestion des fichiers
                    </span>
                </h1>

                <app-attachement-grid-only [classid]="ClassId" [objectid]="ObjectId"></app-attachement-grid-only>
            </div>


        </form>


    </div>
    <div class="workflow-container">
        <app-workflow-decision
                *ngIf="demandeForm &&(demandeForm['workflow']!=undefined ||!(this.demandeForm.userPermission == 'WRITE')) "
                (decisionEvent)="Confirmation($event)"
                (saveEvent)="save()"
                (RetournEvent)="Retourn()"
                [access]="demandeForm['userPermission'] === 'READ' || demandeForm['userPermission'] === 'NONE'"
                [decisions]="decissionWF"
                [object]="demandeForm"
                [SaveObject]="demandeForm">
        </app-workflow-decision>

    </div>

</div>
<!--<app-attachment-->

<!--        [classid]="17"-->

<!--        [objectid]="demandeF.id"-->

<!--        [objectData]="courrierByIdDtoModel"-->

<!--        (refreshedReqFileDef)="getById()"-->

<!--        [URL]="'/tesst'"-->

<!--&gt;</app-attachment>-->
<dx-popup
        [showCloseButton]="true"
        [maxWidth]="'auto'"
        [width]="popupWidth"
        [height]="popupHeight"
        [showTitle]="false"
        title="Workflow Viewer"
        [dragEnabled]="false"
        [closeOnOutsideClick]="true"
        [(visible)]="popupViewerVisible">
    <div *dxTemplate="let data of 'content'">
        <app-journal [viewerUrl]="objectData.workflow.wfProcessID" [historicsWF]="objectData.workflow.historicWF" [historicsEvt]="objectData.events"
                     [historicsAcces]="objectData.userActivity"></app-journal>
    </div>
</dx-popup>
<dx-load-panel
    #loadPanel
    shadingColor="rgba(0,0,0,0)"
    [position]="{ of: '#employee' }"
    [(visible)]="loadingVisible"
    [showIndicator]="true"
    [showPane]="true"
    [shading]="true"
    [hideOnOutsideClick]="false"
    (onShown)="onShown()"
    (onHidden)="onHidden()"
>
</dx-load-panel>