<dx-popup
        [maxWidth]="940"
        [width]="500"
        [height]="'auto'"
        [showTitle]="true"
        title="Créer une opportunité"
        [dragEnabled]="false"
        [closeOnOutsideClick]="true"
        [(visible)]="showModal">

    <p>Voulez-vous créer une offre pour cette opportunité ?</p>
    <div class="row">
        <div class="col-lg-6 col-md-6 col-sm-8 col-xs-12">
            <button
                    class="btn btn-secondary"
                    (click)="onCancelClick()">Annuler</button> </div>
        <div class="col-lg-6 col-md-6 col-sm-8 col-xs-12 alignRight">
            <button
                    class="btn btn-primary"
                    (click)="onCreateOpportunityClick()">Créer offre</button></div>
    </div>
</dx-popup>
<div>

    <div>

        <div class="card-header text-center bg-secondary text-white" style="background-color: #40B3A2 !important;">
            <div class="d-flex justify-content-center align-items-center" style="width: 100%;">
                <div *ngIf="demandedto!=undefined" class="d-flex align-items-center">
                    <h5> edit opportunité ({{demandedto?.id}})</h5>
                    <div class="icon-container ml-3" style="cursor: pointer;" (click)="showPopupWF()" title="{{'show-event.Voir la liste des événements' | translate}}">
                        <i class="fas fa-project-diagram"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


<ul class="nav nav-tabs nav-fill mb-3" id="ex1" role="tablist">
    <li class="nav-item" role="presentation">
        <a
                data-mdb-tab-init
                class="nav-link active"
                id="ex2-tab-1"
                href="#ex2-tabs-1"
                role="tab"
                aria-controls="ex2-tabs-1"
                aria-selected="true"
        >Opportunité</a
        >
    </li>
    <li class="nav-item" role="presentation">
        <a
                data-mdb-tab-init
                class="nav-link"
                id="ex2-tab-2"
                href="#ex2-tabs-2"
                role="tab"
                aria-controls="ex2-tabs-2"
                aria-selected="false"
        >Opportunité Info</a
        >
    </li>
    <li class="nav-item" role="presentation">
        <a
                data-mdb-tab-init
                class="nav-link"
                id="ex2-tab-3"
                href="#ex2-tabs-3"
                role="tab"
                aria-controls="ex2-tabs-3"
                aria-selected="false"
        >Demande Info </a
        >
    </li>
</ul>
<!-- Tabs navs -->

<!-- Tabs content -->
<div class="tab-content" id="ex2-content">
    <div
            class="tab-pane fade show active"
            id="ex2-tabs-1"
            role="tabpanel"
            aria-labelledby="ex2-tab-1"
    >
        <div class="tab-content" >
            <!-- acctiver when verification is true-->
            <div
                    class="tab-pane fade {{ creationOpp ? 'show active' : '' }}"

                    role="tabpanel"
                    aria-labelledby="ex3-tab-1"
                    *ngIf="creationOpp"
            >
                <div class="custom-field">
                    <h1>
                    <span>
                      Gestion des fichiers
                    </span>
                    </h1>
                    <div class="fieldContent">
                <form [formGroup]="oppF" class="row g-3 needs-validation custom-form" novalidate>


                    <section class="light" >
                        <div class="container py-2">
                            <div class="h1 text-center text-dark" id="pageHeaderTitle2"></div>


                            <article class="postcard light green">
                                <a class="postcard__img_link" href="#">
                                    <!--                    <img class="postcard__img" src="https://picsum.photos/500/501" alt="Image Title" />-->
                                </a>
                                <div class="postcard__text t-dark">


                                    <div class="form-group ">
                                        <label for="nom" class="form-label">Nom:</label>
                                        <input class="form-control" formControlName="nom" id="nom" type="text" required>

                                    </div>



                                    <div class="form-group ">
                                        <label for="description" class="form-label">Description:</label>
                                        <textarea class="form-control" formControlName="description" id="description" type="text" required></textarea>

                                    </div>


                                </div>

                            </article>

                        </div>

                    </section>


                    <section class="light" *ngIf="selectedDemande">
                        <div class="container py-2">
                            <div class="h1 text-center text-dark" id="pageHeaderTitle"></div>


                            <article class="postcard light green">
                                <a class="postcard__img_link" href="#">
                                    <!--                    <img class="postcard__img" src="https://picsum.photos/500/501" alt="Image Title" />-->
                                </a>
                                <div class="postcard__text t-dark">
                                    <h5><a href="#">Demande informations</a></h5>
                                    <div class="postcard__subtitle small">
                                        <time datetime="2020-05-25 12:00:00">
                                            <i class="fas fa-calendar-alt mr-2"></i>Mon, May 25th 2020
                                        </time>
                                    </div>
                                    <div class="postcard__bar"></div>
                                    <!--                    <div class="postcard__preview-txt">Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, fugiat asperiores inventore beatae accusamus odit minima enim, commodi quia, doloribus eius! Ducimus nemo accusantium maiores velit corrupti tempora reiciendis molestiae repellat vero. Eveniet ipsam adipisci illo iusto quibusdam, sunt neque nulla unde ipsum dolores nobis enim quidem excepturi, illum quos!</div>-->
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="nomDemande" class="form-label">Nom Demande:</label>
                                            <input class="form-control" id="nomDemande" type="text" [value]="demandeF.get('nom').value" readonly>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="client" class="form-label">Client:</label>
                                            <input class="form-control" id="client" type="text" [value]="demandeF.get('client').value" readonly>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="statut" class="form-label">Statut:</label>
                                            <input class="form-control" id="statut" type="text" [value]="demandeF.get('statut').value" readonly>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="source" class="form-label">Source:</label>
                                            <input class="form-control" id="source" type="text" [value]="demandeF.get('source').value" readonly>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="commentaires" class="form-label">Commentaires:</label>
                                            <input class="form-control" id="commentaires" type="text" [value]="demandeF.get('commentaires').value" readonly>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="deadline" class="form-label">Deadline:</label>
                                            <input class="form-control" id="deadline" type="text" [value]="demandeF.get('deadline').value" readonly>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="descriptionDemande" class="form-label">Description Demande:</label>
                                        <textarea class="form-control" id="descriptionDemande" type="text" [value]="demandeF.get('description').value" readonly></textarea>
                                    </div>
                                </div>
                            </article>

                        </div>
                    </section>
                    <div class="custom-field">
                        <h1>
                    <span>
                      Gestion des fichiers
                    </span>
                        </h1>
                        <div class="fieldContent">
                        <app-attachement-grid-only [classid]="ClassId" [objectid]="ObjectId"></app-attachement-grid-only>
                        </div>
                    </div>


                    <div class="workflow-container">
                        <!--            <button (click)="Return()" class="btn btn-light" mdbRipple type="button">Annuler</button>-->
                        <!--            <button class="btn btn-success me-md-2" mdbRipple type="submit">Confirmer</button>-->
                        <app-workflow-decision
                                *ngIf="oppForm &&(oppForm['workflow']!=undefined ||!(this.oppForm.userPermission == 'WRITE')) "
                                (decisionEvent)="Confirmation($event)"
                                (saveEvent)="save()"
                                (RetournEvent)="Retourn()"
                                [access]="oppForm['userPermission'] === 'READ' || oppForm['userPermission'] === 'NONE'"
                                [decisions]="decissionWF"
                                [object]="oppForm"
                                [SaveObject]="oppForm">
                        </app-workflow-decision>

                        <!--        <div class="d-grid gap-2 d-md-flex justify-content-md-between">-->
                        <!--            <button mdbRipple class="btn btn-light" type="button" (click)="Return()">Annuler</button>-->
                        <!--            <button mdbRipple class="btn btn-success me-md-2" type="submit" >Confirmer</button>-->

                    </div>
                </form>
                    </div>
                </div>
            </div>
            <div
                    class="tab-pane fade {{ Affectaionequipe ? 'show active' : '' }}"

                    role="tabpanel"
                    aria-labelledby="ex3-tab-2"
                    *ngIf="Affectaionequipe"
            >



                <style>
                    /* Defining a custom border on all
                        sides except the top side */
                    .custom-field {
                        border: 1px solid #40B3A2;
                        border-top: none;
                        margin-top: 32px ;

                        padding: 8px;
                        border-radius: 8px !important;
                    }

                    /* Defining the style of the
                    heading/legend for custom fieldset */
                    .custom-field h1 {
                        font-size: 15px;
                        margin: -16px -8px 0;
                        color: #40B3A2;

                        font-weight: 500;
                    }

                    /* Using float:left allows us to mimic
                       the legend like fieldset. The
                       float:right property can also be
                       used to show the legend on right side */

                    .custom-field h1 span {
                        float: left;
                    }

                    /* Creating the custom top border to make
                        it look like fieldset defining small
                        border before the legend. The width
                        can be modified to change position
                        of the legend */
                    .custom-field h1:before {
                        border-top: 1px solid #40B3A2;
                        content: ' ';
                        float: left;
                        margin: 8px 2px 0 2px;
                        width: 20px;
                        border-radius: 8px !important;
                    }

                    /* Defining a long border after the
                    legend, using overflow hidden to
                    actually hide the line behind the
                    legend text. It can be removed
                    for a different effect */
                    .custom-field h1:after {
                        border-top: 1px solid #40B3A2;
                        content: ' ';
                        display: block;
                        height: 24px;
                        left: 2px;
                        margin: 0 1px 0 0;
                        overflow: hidden;
                        position: relative;
                        top: 8px;
                        border-top-right-radius: 8px ;
                    }
                    .fieldContent{

                        padding: 20px;
                    }
                </style>



                <form [formGroup]="oppF" class="g-3 needs-validation custom-form" novalidate>
                    <div class="custom-field">
                        <h1>
                    <span>
                        Opportunité
                    </span>
                        </h1>
                        <div class="fieldContent">
                            <article class="postcard light green">
                                <a class="postcard__img_link" href="#">
                                    <!--                    <img class="postcard__img" src="https://picsum.photos/500/501" alt="Image Title" />-->
                                </a>
                                <div class="postcard__text t-dark">


                                    <div class="form-group ">
                                        <label for="nom" class="form-label">Nom:</label>
                                        <input class="form-control" formControlName="nom" type="text" required>
                                        <!--        <div *ngIf="demandeForm.get('nom').invalid && (demandeForm.get('nom').dirty || demandeForm.get('nom').touched)"-->
                                        <!--             class="alert alert-danger">-->
                                        <!--            <div *ngIf="demandeForm.get('nom').errors.required">-->
                                        <!--                Nom is required.-->
                                        <!--            </div>-->
                                        <!--        </div>-->
                                    </div>

                                    <div class="form-group ">
                                        <label for="description" class="form-label">Description:</label>
                                        <textarea class="form-control" formControlName="description" type="text" required></textarea>

                                    </div>


                                </div>

                                <div class="form-group">
                                    <label>Select Equipe</label>
                                    <select formControlName="nomDepartement" class="form-select" (change)="onDepartementChange($event)">
                                        <option *ngFor="let client of gridDataSource" [value]="client.name">{{ client.name }}</option>
                                    </select>

                                </div>
                            </article>

                        </div>

                    </div>
                </form>

                <!--mena touda louila-->
                <!--thenya-->
                <div class="custom-field">
                    <h1>
                    <span>
                        Etudes d'opportunitées
                    </span>
                    </h1>
                    <div class="fieldContent">
                        <dx-data-grid
                                id="orders"
                                [dataSource]="productsDataSource"
                                [repaintChangesOnly]="true"
                                [columnAutoWidth]="true"
                                [showBorders]="true"
                                (onExporting)="onExporting($event)"
                        >
                            <dxo-selection mode="multiple"></dxo-selection>
                            <dxo-paging [pageSize]="10"></dxo-paging>

                            <dxi-column dataField="description" dataType="string"></dxi-column>
                            <dxi-column
                                    dataField="nature"
                                    dataType="string"
                                    format="currency"
                            ></dxi-column>
                            <dxi-column dataField="responsableEtude" dataType="datetime"></dxi-column>
                            <dxi-column dataField="dateDebut" dataType="number"></dxi-column>
                            <dxi-column
                                    dataField="nbreHours"
                                    dataType="number"

                                    [allowSorting]="true"
                            ></dxi-column>

                            <dxo-master-detail [enabled]="true" template="tacheDetail">
                            </dxo-master-detail>
                            <div *dxTemplate="let detail of 'tacheDetail'">
                                <dx-data-grid
                                        [dataSource]="getDetailGridDataSource(detail.data)"
                                        [columnAutoWidth]="true"
                                        [repaintChangesOnly]="true"
                                        [showBorders]="true"
                                >
                                    <dxo-paging [pageSize]="5"></dxo-paging>

                                    <dxi-column dataField="id" dataType="number" caption="ID"></dxi-column>
                                    <dxi-column dataField="nom" dataType="string" caption="Nom"></dxi-column>
                                    <dxi-column dataField="description" dataType="string" caption="Description"></dxi-column>
                                    <dxi-column dataField="nbreHours" dataType="string" caption="nombre des heures" ></dxi-column>
                                    <dxi-column dataField="nombre des ingénieurs" dataType="string" caption="nombre des ingénieurs" ></dxi-column>
                                </dx-data-grid>
                            </div>
                            <dxo-export
                                    [enabled]="true"
                                    [formats]="['pdf']"
                                    [allowExportSelectedData]="true"
                            ></dxo-export>
                            <dxo-search-panel
                                    [visible]="true"
                                    [highlightCaseSensitive]="true"
                            ></dxo-search-panel>
                        </dx-data-grid>
                    </div>
                </div>
                <!--thenya toufa lena -->
                <div class="custom-field">
                    <h1>
                    <span>
                      Gestion des fichiers
                    </span>
                    </h1>
                    <div class="fieldContent">
                        <app-attachement-grid-only [classid]="ClassId" [objectid]="ObjectId"></app-attachement-grid-only>
                    </div>
                </div>
                <div class="workflow-container">
                    <!--            <button (click)="Return()" class="btn btn-light" mdbRipple type="button">Annuler</button>-->
                    <!--            <button class="btn btn-success me-md-2" mdbRipple type="submit">Confirmer</button>-->
                    <app-workflow-decision
                            *ngIf="oppForm &&(oppForm['workflow']!=undefined ||!(this.oppForm.userPermission == 'WRITE')) "
                            (decisionEvent)="Confirmation($event)"
                            (saveEvent)="save2()"
                            (RetournEvent)="Retourn()"
                            [access]="oppForm['userPermission'] === 'READ' || oppForm['userPermission'] === 'NONE'"
                            [decisions]="decissionWF"
                            [object]="oppForm"
                            [SaveObject]="oppForm">
                    </app-workflow-decision>

                    <!--        <div class="d-grid gap-2 d-md-flex justify-content-md-between">-->
                    <!--            <button mdbRipple class="btn btn-light" type="button" (click)="Return()">Annuler</button>-->
                    <!--            <button mdbRipple class="btn btn-success me-md-2" type="submit" >Confirmer</button>-->

                </div>



            </div>

            <div
                    class="tab-pane fade {{ etude ? 'show active' : '' }}"

                    role="tabpanel"
                    aria-labelledby="ex3-tab-3"
                    *ngIf="etude"
            >

                <div class="custom-field">
                    <h1>
                    <span>
                        Etude d'opportunité
                    </span>
                    </h1>
                    <div class="fieldContent">

                    </div>
                <form [formGroup]="techForm" >
                    <div class="form-group">
                        <label>Nature:</label>

                        <select class="form-select" formControlName="source" id="sourceDemande">
                            <option value="etudeFaisabilite">Étude de faisabilité</option>
                            <option value="etudeTechnique">Étude technique</option>

                        </select>
                        <div *ngIf="techForm.get('nature').invalid && techForm.get('nature').touched">
                            <span *ngIf="techForm.get('nature').errors.required">Nature is required</span>
                        </div>
                    </div>

                    <div class="form-group">

                        <label for="specialite">Spécialité:</label>
                        <select class="form-select" formControlName="specialite" id="specialite">
                            <option value="developpement-web">Développement Web</option>
                            <option value="developpement-mobile">Développement Mobile</option>
                            <option value="data-science">Data Science</option>
                            <option value="cybersecurite">Cybersécurité</option>
                            <option value="intelligence-artificielle">Intelligence Artificielle</option>
                            <option value="gestion-de-projet">Gestion de Projet</option>
                        </select>
                        <div *ngIf="techForm.get('specialite').invalid && techForm.get('specialite').touched">
                            <span *ngIf="techForm.get('specialite').errors.required">Spécialité is required</span>
                        </div>

                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                        <label for="nbreHours">Number of Hours:</label>
                        <input  class="form-control"  type="number" id="nbreHours" formControlName="nbreHours">
                        <div *ngIf="techForm.get('nbreHours').invalid && techForm.get('nbreHours').touched">
                            <span *ngIf="techForm.get('nbreHours').errors.required">Number of Hours is required</span>
                        </div>
                        </div>


                        <div class="form-group col-md-6">
                        <label for="dateDebut">Date Debut:</label>
                        <input type="date"  class="form-control" id="dateDebut" formControlName="dateDebut">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="responsableEtude">Responsable Etude:</label>
                        <input class="form-control"  type="text" id="responsableEtude" formControlName="responsableEtude">
                        <div *ngIf="techForm.get('responsableEtude').invalid && techForm.get('responsableEtude').touched">
                            <span *ngIf="techForm.get('responsableEtude').errors.required">Responsible Etude is required</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="description">Description:</label>
                        <textarea type="text" class="form-control" formControlName="description"></textarea>
                        <div *ngIf="techForm.get('description').invalid && techForm.get('description').touched">
                            <span *ngIf="techForm.get('description').errors.required">Description is required</span>
                        </div>
                    </div>

                </form>

                </div>
                <div class="custom-field">
                    <h1>
                    <span>
                        Details
                    </span>
                    </h1>
                    <div class="fieldContent">

                    </div>
                <dx-data-grid
                        #gridContainer

                        [dataSource]="tasks"

                        [columns]="['nom', 'description', 'nbreHours']"
                        [showBorders]="true"
                        (onToolbarPreparing)="onToolbarPreparing($event)"
                        ID="gridContainer"
                        keyExpr="ID"
                >
                    <dxi-column dataField="nom"></dxi-column>
                    <dxi-column dataField="description"></dxi-column>
                    <dxi-column dataField="nbreHours"></dxi-column>
                    <dxi-column [allowResizing]="false"
                                [fixed]="false" caption="{{'' | translate}}"
                                cellTemplate="cellTemplateActions"
                    >
                    </dxi-column>
                    <div *dxTemplate="let data of 'cellTemplateActions'"
                         style="display: flex; justify-content: center; align-items: center;">


                        <a (click)="deleteDetails(data.data.ID)" target="_blank"   title="" >
                            <i class="fa fa-trash" style="color:#168c94;">
                            </i></a>
                    </div>
                </dx-data-grid>
                    <dx-popup
                            [(visible)]="popupVisible"
                            [width]="600"
                            [height]="400"
                            [showTitle]="true"
                            title="Ajouter details"
                            [dragEnabled]="true"
                            [closeOnOutsideClick]="true">
                        <div *dxTemplate="let data of 'content'">
                            <form [formGroup]="taskForm">
                                <div class="form-group">
                                    <label for="nom">Nom:</label>
                                    <input type="text" class="form-control" formControlName="nom">
                                </div>

                                <div class="form-group">
                                    <label for="nbreHours">Number of Hours:</label>
                                    <input type="number" class="form-control" formControlName="nbreHours">
                                </div>
                                <div class="form-group">
                                    <label for="description">Description:</label>
                                    <textarea type="text" class="form-control" formControlName="description"></textarea>
                                </div>
                            </form>
                            <div class="dx-popup-bottom">
                                <button type="button" class="btn btn-secondary" (click)="closePopup()">Cancel</button>
                                <button type="button" class="btn btn-primary" (click)="addTask()">Add</button>
                            </div>
                        </div>
                    </dx-popup>
                </div>
                <div class="custom-field">
                    <h1>
                    <span>
                      Gestion des fichiers
                    </span>
                    </h1>
                    <div class="fieldContent">
                        <app-attachement-grid-only [classid]="ClassId" [objectid]="ObjectId"></app-attachement-grid-only>
                    </div>
                </div>
                <div class="workflow-container">
                    <!--            <button (click)="Return()" class="btn btn-light" mdbRipple type="button">Annuler</button>-->
                    <!--            <button class="btn btn-success me-md-2" mdbRipple type="submit">Confirmer</button>-->
                    <app-workflow-decision
                            *ngIf="oppForm &&(oppForm['workflow']!=undefined ||!(this.oppForm.userPermission == 'WRITE')) "
                            (decisionEvent)="Confirmation($event)"
                            (saveEvent)="save()"
                            (RetournEvent)="Retourn()"
                            [access]="oppForm['userPermission'] === 'READ' || oppForm['userPermission'] === 'NONE'"
                            [decisions]="decissionWF"
                            [object]="oppForm"
                            [SaveObject]="oppForm">
                    </app-workflow-decision>

                    <!--        <div class="d-grid gap-2 d-md-flex justify-content-md-between">-->
                    <!--            <button mdbRipple class="btn btn-light" type="button" (click)="Return()">Annuler</button>-->
                    <!--            <button mdbRipple class="btn btn-success me-md-2" type="submit" >Confirmer</button>-->

                </div>
                <br>
            </div>



            <!-- Content for new tab -->
            <div
                    class="tab-pane fade {{ rapport ? 'show active' : '' }}"
                    id="ex3-tabs-4"
                    role="tabpanel"
                    aria-labelledby="ex3-tab-4"
                    *ngIf="rapport"
            >

                <form [formGroup]="oppF" class="row g-3 needs-validation custom-form" novalidate>




                    <article class="postcard light green">
                        <a class="postcard__img_link" href="#">
                            <!--                    <img class="postcard__img" src="https://picsum.photos/500/501" alt="Image Title" />-->
                        </a>
                        <div class="postcard__text t-dark">


                            <div class="form-group ">
                                <label for="nom" class="form-label">Nom:</label>
                                <input class="form-control" formControlName="nom" type="text" required>
                                <!--        <div *ngIf="demandeForm.get('nom').invalid && (demandeForm.get('nom').dirty || demandeForm.get('nom').touched)"-->
                                <!--             class="alert alert-danger">-->
                                <!--            <div *ngIf="demandeForm.get('nom').errors.required">-->
                                <!--                Nom is required.-->
                                <!--            </div>-->
                                <!--        </div>-->
                            </div>


                            <div class="form-group ">
                                <label for="description" class="form-label">Description:</label>
                                <textarea class="form-control" formControlName="description" type="text" required></textarea>

                            </div>



                        </div>

                    </article>

                    <div class="custom-field">
                        <h1>
                    <span>
                      Gestion des fichiers
                    </span>
                        </h1>
                        <div class="fieldContent">
                            <app-attachement-grid-only [classid]="ClassId" [objectid]="ObjectId"></app-attachement-grid-only>
                        </div>
                    </div>

                    <div class="workflow-container">
                        <!--            <button (click)="Return()" class="btn btn-light" mdbRipple type="button">Annuler</button>-->
                        <!--            <button class="btn btn-success me-md-2" mdbRipple type="submit">Confirmer</button>-->
                        <app-workflow-decision
                                *ngIf="oppForm &&(oppForm['workflow']!=undefined ||!(this.oppForm.userPermission == 'WRITE')) "
                                (decisionEvent)="Confirmation($event)"
                                (saveEvent)="save()"
                                (RetournEvent)="Retourn()"
                                [access]="oppForm['userPermission'] === 'READ' || oppForm['userPermission'] === 'NONE'"
                                [decisions]="decissionWF"
                                [object]="oppForm"
                                [SaveObject]="oppForm">
                        </app-workflow-decision>

                        <!--        <div class="d-grid gap-2 d-md-flex justify-content-md-between">-->
                        <!--            <button mdbRipple class="btn btn-light" type="button" (click)="Return()">Annuler</button>-->
                        <!--            <button mdbRipple class="btn btn-success me-md-2" type="submit" >Confirmer</button>-->

                    </div>
                </form>

            </div>


            <div
                    class="tab-pane fade {{ elsebool ? 'show active' : '' }}"
                    id="ex3-tabs-5"
                    role="tabpanel"
                    aria-labelledby="ex3-tab-5"
                    *ngIf="elsebool"
            >


                <form [formGroup]="oppF" class="row g-3 needs-validation custom-form" novalidate>




                    <article class="postcard light green">
                        <a class="postcard__img_link" href="#">
                            <!--                    <img class="postcard__img" src="https://picsum.photos/500/501" alt="Image Title" />-->
                        </a>
                        <div class="postcard__text t-dark">


                            <div class="form-group ">
                                <label for="nom" class="form-label">Nom:</label>
                                <input class="form-control" formControlName="nom" type="text" required>
                                <!--        <div *ngIf="demandeForm.get('nom').invalid && (demandeForm.get('nom').dirty || demandeForm.get('nom').touched)"-->
                                <!--             class="alert alert-danger">-->
                                <!--            <div *ngIf="demandeForm.get('nom').errors.required">-->
                                <!--                Nom is required.-->
                                <!--            </div>-->
                                <!--        </div>-->
                            </div>



                            <div class="form-group ">
                                <label for="description" class="form-label">Description:</label>
                                <textarea class="form-control" formControlName="description" type="text" required></textarea>

                            </div>

                            <!--                                    <div class="upload-container">-->
                            <!--                                        <div class="input-div">-->
                            <!--                                            <input class="input" name="file" type="file" (change)="onFileChange($event)" >-->
                            <!--                                            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" stroke-linejoin="round" stroke-linecap="round" viewBox="0 0 24 24" stroke-width="2" fill="none" stroke="currentColor" class="icon"><polyline points="16 16 12 12 8 16"></polyline><line y2="21" x2="12" y1="12" x1="12"></line><path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"></path><polyline points="16 16 12 12 8 16"></polyline></svg>-->
                            <!--                                        </div>-->
                            <!--                                    </div>-->

                        </div>


                    </article>

                    <div class="custom-field">
                        <h1>
    <span>
        Etudes d'opportunitées
    </span>
                        </h1>
                        <div class="fieldContent">
                            <dx-data-grid

                                    [dataSource]="productsDataSource"
                                    [repaintChangesOnly]="true"
                                    [columnAutoWidth]="true"
                                    [showBorders]="true"
                                    (onExporting)="onExporting($event)"
                            >
                                <dxo-selection mode="multiple"></dxo-selection>
                                <dxo-paging [pageSize]="10"></dxo-paging>

                                <dxi-column dataField="description" dataType="string"></dxi-column>
                                <dxi-column
                                        dataField="nature"
                                        dataType="string"
                                        format="currency"
                                ></dxi-column>
                                <dxi-column dataField="responsableEtude" dataType="datetime"></dxi-column>
                                <dxi-column dataField="dateDebut" dataType="number"></dxi-column>
                                <dxi-column
                                        dataField="nbreHours"
                                        dataType="number"

                                        [allowSorting]="true"
                                ></dxi-column>

                                <dxo-master-detail [enabled]="true" template="tacheDetail">
                                </dxo-master-detail>
                                <div *dxTemplate="let detail of 'tacheDetail'">
                                    <dx-data-grid
                                            [dataSource]="getDetailGridDataSource(detail.data)"
                                            [columnAutoWidth]="true"
                                            [repaintChangesOnly]="true"
                                            [showBorders]="true"
                                    >
                                        <dxo-paging [pageSize]="5"></dxo-paging>

                                        <dxi-column dataField="id" dataType="number" caption="ID"></dxi-column>
                                        <dxi-column dataField="nom" dataType="string" caption="Nom"></dxi-column>
                                        <dxi-column dataField="description" dataType="string" caption="Description"></dxi-column>
                                        <dxi-column dataField="nbreHours" dataType="string" caption="nombre des heures" ></dxi-column>
                                           </dx-data-grid>
                                </div>
                                <dxo-export
                                        [enabled]="true"
                                        [formats]="['pdf']"
                                        [allowExportSelectedData]="true"
                                ></dxo-export>
                                <dxo-search-panel
                                        [visible]="true"
                                        [highlightCaseSensitive]="true"
                                ></dxo-search-panel>
                            </dx-data-grid>
                        </div>
                    </div>
                    <div class="custom-field">
                        <h1>
                    <span>
                      Gestion des fichiers
                    </span>
                        </h1>
                        <div class="fieldContent">
                            <app-attachement-grid-only [classid]="ClassId" [objectid]="ObjectId"></app-attachement-grid-only>
                        </div>
                    </div>
                    <div class="workflow-container">
                        <!--            <button (click)="Return()" class="btn btn-light" mdbRipple type="button">Annuler</button>-->
                        <!--            <button class="btn btn-success me-md-2" mdbRipple type="submit">Confirmer</button>-->
                        <app-workflow-decision
                                *ngIf="oppForm &&(oppForm['workflow']!=undefined ||!(this.oppForm.userPermission == 'WRITE')) "
                                (decisionEvent)="Confirmation($event)"
                                (saveEvent)="save()"
                                (RetournEvent)="Retourn()"
                                [access]="oppForm['userPermission'] === 'READ' || oppForm['userPermission'] === 'NONE'"
                                [decisions]="decissionWF"
                                [object]="oppForm"
                                [SaveObject]="oppForm">
                        </app-workflow-decision>

                        <!--        <div class="d-grid gap-2 d-md-flex justify-content-md-between">-->
                        <!--            <button mdbRipple class="btn btn-light" type="button" (click)="Return()">Annuler</button>-->
                        <!--            <button mdbRipple class="btn btn-success me-md-2" type="submit" >Confirmer</button>-->

                    </div>
                </form>

            </div>


            <div
                    class="tab-pane fade {{ elsebool1 ? 'show active' : '' }}"
                    id="ex3-tabs-6"
                    role="tabpanel"
                    aria-labelledby="ex3-tab-5"
                    *ngIf="elsebool1"
            >

                <form [formGroup]="oppF" class="row g-3 needs-validation custom-form" novalidate>




                    <article class="postcard light green">
                        <a class="postcard__img_link" href="#">
                            <!--                    <img class="postcard__img" src="https://picsum.photos/500/501" alt="Image Title" />-->
                        </a>
                        <div class="postcard__text t-dark">


                            <div class="form-group ">
                                <label for="nom" class="form-label">Nom:</label>
                                <input class="form-control" formControlName="nom" type="text" required>
                                <!--        <div *ngIf="demandeForm.get('nom').invalid && (demandeForm.get('nom').dirty || demandeForm.get('nom').touched)"-->
                                <!--             class="alert alert-danger">-->
                                <!--            <div *ngIf="demandeForm.get('nom').errors.required">-->
                                <!--                Nom is required.-->
                                <!--            </div>-->
                                <!--        </div>-->
                            </div>



                            <div class="form-group ">
                                <label for="description" class="form-label">Description:</label>
                                <textarea class="form-control" formControlName="description" type="text" required></textarea>

                            </div>

                        </div>


                    </article>

                    <div class="custom-field">
                        <h1>
                    <span>
                      Gestion des fichiers
                    </span>
                        </h1>
                        <div class="fieldContent">
                            <app-attachement-grid-only [classid]="ClassId" [objectid]="ObjectId"></app-attachement-grid-only>
                        </div>
                    </div>

                    <div class="workflow-container">
                        <!--            <button (click)="Return()" class="btn btn-light" mdbRipple type="button">Annuler</button>-->
                        <!--            <button class="btn btn-success me-md-2" mdbRipple type="submit">Confirmer</button>-->
                        <app-workflow-decision
                                *ngIf="oppForm &&(oppForm['workflow']!=undefined ||!(this.oppForm.userPermission == 'WRITE')) "
                                (decisionEvent)="Confirmation($event)"
                                (saveEvent)="save()"
                                (RetournEvent)="Retourn()"
                                [access]="oppForm['userPermission'] === 'READ' || oppForm['userPermission'] === 'NONE'"
                                [decisions]="decissionWF"
                                [object]="oppForm"
                                [SaveObject]="oppForm">
                        </app-workflow-decision>

                        <!--        <div class="d-grid gap-2 d-md-flex justify-content-md-between">-->
                        <!--            <button mdbRipple class="btn btn-light" type="button" (click)="Return()">Annuler</button>-->
                        <!--            <button mdbRipple class="btn btn-success me-md-2" type="submit" >Confirmer</button>-->

                    </div>
                </form>

            </div>

        </div>
    </div>
    <div
            class="tab-pane fade"
            id="ex2-tabs-2"
            role="tabpanel"
            aria-labelledby="ex2-tab-2"
    >
        <div class="custom-field">
            <h1>
                    <span>
                        Opportunité Info
                    </span>
            </h1>
            <div class="fieldContent">

            </div>
            <div>
                <div class="form-group">
                    <label class="form-label"><b>Nom:</b></label>
                    <input class="form-control"  type="text" [value]="demandedto?.nom" readonly />
                </div>
                <div class="form-group">
                    <label  class="form-label"><b>Description:</b></label>
                    <input  class="form-control"  type="text" [value]="demandedto?.description" readonly />
                </div>


                <div class="form-group">
                    <label class="form-label"><b>Status:</b></label>
                    <input  class="form-control"  type="text" [value]="demandedto?.status" readonly />
                </div>

                <div class="form-group">
                    <label  class="form-label"><b>Created At:</b></label>
                    <input  class="form-control"  type="text" [value]="demandedto?.createAt | date:'medium'" readonly />
                </div>

            </div>
            </div>
        </div>
    </div>
    <div
            class="tab-pane fade"
            id="ex2-tabs-3"
            role="tabpanel"
            aria-labelledby="ex2-tab-3"
    >
        <div class="custom-field">
            <h1>
                    <span>
                        Demande Info
                    </span>
            </h1>
            <div class="fieldContent">

            </div>
        <div >
            <div class="form-group">
                <label class="form-label"><b>Nom demande:</b></label>
                <input class="form-control"  type="text" [value]="demandedto?.demande?.nom " readonly />
            </div>
            <div class="form-group">
                <label class="form-label"><b>Status:</b></label>
                <input  class="form-control"  type="text" [value]="demandedto?.demande?.activityName" readonly />
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label class="form-label"><b>Créer par:</b></label>
                    <input  class="form-control"  type="text" [value]="demandedto?.demande?.assignee" readonly />
                </div>

                <div class="form-group col-md-6">
                    <label  class="form-label"><b>Date de creation demande :</b></label>
                    <input  class="form-control"  type="text" [value]="demandedto?.demande?.dateDeCreation | date:'medium'" readonly />
                </div>
            </div>
            <div class="form-group">
                <label class="form-label"><b>Client:</b></label>
                <input class="form-control"  type="text" [value]="demandedto?.demande?.client?.nom " readonly />
            </div>
        </div>
    </div>
</div>
<!-- Tabs content -->

<dx-popup
        [showCloseButton]="true"
        [maxWidth]="'auto'"
        [width]="popupWidth"
        [height]="popupHeight"
        [showTitle]="false"
        title="Workflow Viewer"
        [dragEnabled]="false"
        [closeOnOutsideClick]="true"
        [(visible)]="popupViewerVisible">
    <div *dxTemplate="let data of 'content'">
        <app-journal
                [viewerUrl]="demandedto?.workflow?.wfProcessID"
                [historicsWF]="demandedto?.workflow?.historicWF"
                [historicsEvt]="demandedto?.events"
                [historicsAcces]="demandedto?.userActivity">
        </app-journal>
    </div>
</dx-popup>
<dx-load-panel
    #loadPanel
    shadingColor="rgba(0,0,0,0.4)"
    [position]="{ of: '#employee' }"
    [(visible)]="loadingVisible"
    [showIndicator]="true"
    [showPane]="true"
    [shading]="true"
    [hideOnOutsideClick]="false"
    (onShown)="onShown()"
    (onHidden)="onHidden()"
>
</dx-load-panel>